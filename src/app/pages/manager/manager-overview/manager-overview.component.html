<div class="container m-auto bg-white p-4">
    <!-- Topics List -->
    @for(topic of topics; track $index) {
        <div class="mb-6">
            <div class="flex justify-between">
                <h3 class="text-left text-2xl font-semibold text-black">
                    {{ topic.name }} - {{ (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length) || 0 }} drawing(s)
                  </h3>
                              
                @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length > 0) {
                    <button (click)="downloadCSV(topic)" class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800">Download CSV</button>
                }
            </div>
            <div class=" justify-center mt-4">
                @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length === 0) {
                    <p class="text-gray-700">No drawings found for this topic.</p>
                }
                @else {
                    @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length > 0) {
                        @if(getUnreviewedDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-blue-200 text-xl flex justify-center items-center font-bold p-4 mr-2">?</span>Unreviewed
                          </h2>
                          @for(drawing of getUnreviewedDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex w-80 m-3 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                        @if(getRequestChangesDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-orange-300 text-xl flex justify-center items-center font-bold p-4 mr-2">!</span>Requested Changes
                          </h2>
                          @for(drawing of getRequestChangesDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex w-80 m-3 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                        @if(getReviewedDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-green-300 text-xl flex justify-center items-center font-bold p-4 mr-2">âœ“</span>Reviewed
                          </h2>
                          @for(drawing of getReviewedDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex m-3 w-72 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                      }
                }
            </div>
        </div>
    }
</div>
