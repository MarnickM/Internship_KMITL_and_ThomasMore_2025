<div class="min-h-screen md:h-screen w-full lg:w-[calc(100vw-256px)] font-montserrat p-5">
  @if(addTopic) {
    <div class="absolute left-0 top-0 min-h-screen md:h-screen w-full lg:w-[calc(100vw-256px)] bg-white z-50 p-5">
      <p class="text-2xl mb-5 leading-none">ADD NEW TOPIC</p>
      <div class="flex flex-col gap-4">
        <input [(ngModel)]="topicForm.name"
        placeholder="Topic name"
        class="p-2 rounded border h-10 w-full md:w-64">
        <input [(ngModel)]="topicForm.ui_image"
        placeholder="Topic image URL"
        class="p-2 rounded border h-10 w-full md:w-64">
        <div class="">
          <div class="flex gap-2 mb-2">
            <input [(ngModel)]="newLabelInput"
                  placeholder="Enter label name"
                  class="p-2 rounded border h-10 w-full md:w-96">
            <button (click)="addLabelToTempList()"
                  class="text-white bg-gray-600 rounded-md hover:bg-gray-900 transition-all duration-300 w-40 h-10">
                Add Label
            </button>
          </div>
          <ul class="md:w-96">
            @for(label of tempLabels; track label.name) {
              <li class="flex justify-between items-center p-2 bg-gray-100 rounded-md">
                <span>{{label.name}}</span>
                <button (click)="removeLabelFromTempList($index)"
                      class="text-red-500 hover:text-red-700">
                    Remove
                </button>
              </li>
            }
          </ul>
        </div>
        <div class="">
          <div class="flex gap-2 mb-2">
            <select [(ngModel)]="selectedEmail" class="p-2 rounded border h-10 w-full md:w-96">
              <option value="" disabled selected>Select user email</option>
              @for(user of users; track user.id) {
                <option [value]="user.email">{{user.email}}</option>
              }
            </select>
            <button (click)="addAccessEmail()"
                  class="text-white bg-gray-600 rounded-md hover:bg-gray-900 transition-all duration-300 w-40 h-10">
                Add Access
            </button>
          </div>
          <ul class="md:w-96">
            @for(email of topicForm.access_user_emails; track email) {
              <li class="flex items-center p-2 bg-gray-100 rounded-md">
                <span class="truncate flex-1 min-w-0 pr-2">{{email}}</span>
                <button (click)="removeAccessEmail(email)"
                      class="text-red-500 hover:text-red-700 whitespace-nowrap">
                    Remove
                </button>
              </li>
            }
          </ul>
        </div>
      </div>
      <div class="flex gap-5 mt-4">
        <button (click)="cancelAddTopic()" class="text-white bg-gray-600 rounded-md hover:bg-gray-900 transition-all duration-300 w-32 h-10">CANCEL</button>
        <button (click)="addTopicToDb()" class="text-white bg-gray-600 rounded-md hover:bg-gray-900 transition-all duration-300 w-32 h-10">ADD TOPIC</button>
      </div>
    </div>
  }
	<h1 class="text-2xl mb-5 leading-none">TOPIC OVERVIEW</h1>
  <div class="flex flex-col md:flex-row gap-5 justify-between items-center mb-5 w-full md:h-10">
    <div class="flex gap-5 flex-col md:flex-row w-full md:w-auto">
      <input
      type="text"
      [(ngModel)]="searchText"
      placeholder="Search topics..."
      class="p-2 rounded border h-10 w-full md:w-64"
    />
      <select [(ngModel)]="sortOption" class="p-2 rounded border h-10 w-full md:w-64">
        <option value="alphabetical">Alphabetical</option>
        <option value="total">Total Drawings</option>
        <option value="unreviewed">Unreviewed Drawings</option>
      </select>
    </div>
    <button (click)="addTopicFunction()" class="text-white bg-gray-600 rounded-md hover:bg-gray-900 transition-all duration-300 w-full md:w-40 h-10">Add new topic</button>
  </div>
  <div class="flex flex-col md:flex-row items-center md:justify-normal gap-5 text-white">
    @for (topic of filteredTopics(); track $index) {
      <div (click)="navigateToTopicOverview(topic.id ?? '')" class="cursor-pointer overflow-hidden w-64 h-64 shadow-md bg-gray-700 rounded-md flex justify-center items-center group relative">
        <div class="absolute top-0 left-0 w-full h-full text-white flex justify-center items-center bg-black rounded-md opacity-0 group-hover:opacity-80 transition-opacity duration-300 z-30">
          <p>Overview</p>
        </div>
        <div class="absolute top-0 left-0 w-full h-full rounded-md group-hover:scale-125 transition-all duration-1000 overflow-hidden">
          <img [src]="topic.ui_image" alt="" class="object-cover w-full h-full rounded-md brightness-75">
        </div>
        <div class="flex flex-col text-center">
          <p class="group-hover:opacity-0 transition-opacity duration-300 z-20">{{ topic.name }}</p>
          <p class="text-xs mt-1 z-20">Drawings: {{ getDrawingCount(topic.id ?? '') }}</p>
          <p class="text-xs z-20">Unreviewed: {{ getUnreviewedDrawingCount(topic.id ?? '') }}</p>
        </div>
      </div>
    }
  </div>
</div> 
	<!-- @for(topic of topics; track $index) {
        <div class="mb-6">
            <div class="flex justify-between">
                <h3 class="text-xl mb-5 leading-none">
                    {{ topic.name }} - {{ (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length) || 0 }} drawing(s)
                  </h3>
                              
                @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length > 0) {
                    <button (click)="downloadCSV(topic)" class="px-4 py-2 bg-black text-white rounded-md hover:bg-gray-800">Download CSV</button>
                }
            </div>
            <div class=" justify-center mt-4">
                @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length === 0) {
                    <p class="text-gray-700">No drawings found for this topic.</p>
                }
                @else {
                    @if (drawingsByTopic[topic.id || ''] && drawingsByTopic[topic.id || ''].length > 0) {
                        @if(getUnreviewedDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-blue-200 text-xl flex justify-center items-center font-bold p-4 mr-2">?</span>Unreviewed
                          </h2>
                          @for(drawing of getUnreviewedDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex w-80 m-3 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                        @if(getRequestChangesDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-orange-300 text-xl flex justify-center items-center font-bold p-4 mr-2">!</span>Requested Changes
                          </h2>
                          @for(drawing of getRequestChangesDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex w-80 m-3 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                        @if(getReviewedDrawings(topic.id || '').length > 0) {
                          <h2 class="text-xl font-bold mt-6 mb-2 flex items-center">
                            <span class="rounded-full w-5 h-5 bg-green-300 text-xl flex justify-center items-center font-bold p-4 mr-2">âœ“</span>Reviewed
                          </h2>
                          @for(drawing of getReviewedDrawings(topic.id || ''); track $index) {
                            <div>
                              <div class="flex m-3 w-72 shadow-lg border border-black rounded-md overflow-hidden">
                                <div class="h-20 w-72 bg-gray-100 p-2 flex flex-col justify-center">
                                  <p class="text-black font-semibold">{{ getWriterName(drawing.writer_id) }}</p>
                                  <p class="text-gray-700">{{ drawing.description }}</p>
                                </div>
                                <div class="flex flex-col justify-center items-center">
                                  <button (click)="viewDrawing(drawing, topic.name, topic.id || '')"
                                          class="bg-black hover:bg-gray-800 transition-all duration-100 w-20 h-full text-white rounded-tr-md">View</button>
                                  <button (click)="deleteDrawing(drawing.id!, topic.id || '')"
                                          class="bg-red-500 hover:bg-red-400 transition-all duration-100 w-20 h-full text-white rounded-br-md">Delete</button>
                                </div>
                              </div>
                            </div>
                          }
                        }
                      }
                }
            </div>
        </div>
    } -->

